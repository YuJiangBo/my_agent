<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yu.my_agent.mapper.postgresql.ChatMessageMapper">

    <insert id="insertChatMessage">
        INSERT INTO my_agent.chat_messages (id, session_id, message_type, content, created_at) VALUES (#{id}, #{sessionId}, #{messageType}, #{content}, #{createdAt})
    </insert>


    <select id="findBySessionId" resultType="com.yu.my_agent.entity.postgresql.ChatMessage">
        SELECT * FROM chat_messages WHERE session_id = #{sessionId} ORDER BY created_at ASC
    </select>

    <select id="findLatestBySessionId" resultType="com.yu.my_agent.entity.postgresql.ChatMessage">
        SELECT * FROM chat_messages WHERE session_id = #{sessionId} ORDER BY created_at DESC LIMIT #{limit}
    </select>

    <select id="countBySessionId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM chat_messages WHERE session_id = #{sessionId}
    </select>


</mapper>
